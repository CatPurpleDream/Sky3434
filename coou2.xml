if not game:IsLoaded() then
    game.Loaded:Wait()
end

local lighting = game:GetService("Lighting")

-- 清除现有的效果
for _, obj in pairs(lighting:GetChildren()) do
    if obj:IsA("Sky") or obj:IsA("BloomEffect") or obj:IsA("BlurEffect") or obj:IsA("ColorCorrectionEffect") or obj:IsA("SunRaysEffect") then
        obj:Destroy()
    end
end

-- 创建星空天空盒（夜晚用）
local NightSky = Instance.new("Sky")
NightSky.Name = "StarryNightSky"
NightSky.SkyboxUp = "rbxassetid://159454299"
NightSky.SkyboxLf = "rbxassetid://159454299"
NightSky.SkyboxBk = "rbxassetid://159454299"
NightSky.SkyboxFt = "rbxassetid://159454299"
NightSky.SkyboxDn = "rbxassetid://159454299"
NightSky.SkyboxRt = "rbxassetid://5198893884"  -- 木星在右侧
NightSky.StarCount = 2000
NightSky.Parent = lighting

-- 创建蓝天天空盒（白天用）
local DaySky = Instance.new("Sky")
DaySky.Name = "DaySky"
DaySky.SkyboxUp = "rbxassetid://985114447"
DaySky.SkyboxLf = "rbxassetid://985114322"
DaySky.SkyboxBk = "rbxassetid://985114322"
DaySky.SkyboxFt = "rbxassetid://985114322"
DaySky.SkyboxDn = "rbxassetid://985114193"
DaySky.SkyboxRt = "rbxassetid://5198893884"
DaySky.SunAngularSize = 0.3
DaySky.CelestialBodiesShown = false
DaySky.Parent = lighting

-- 月光效果（夜晚用）
local MoonRays = Instance.new("SunRaysEffect")
MoonRays.Name = "MoonRays"
MoonRays.Intensity = 0.05
MoonRays.Spread = 0.1
MoonRays.Parent = lighting

local MoonBloom = Instance.new("BloomEffect")
MoonBloom.Name = "MoonBloom"
MoonBloom.Intensity = 0.1
MoonBloom.Threshold = 0.2
MoonBloom.Size = 30
MoonBloom.Parent = lighting

-- 时间设置
local currentTime = 12  -- 中午12点开始
local timeSpeed = 60    -- 时间流逝速度

-- 设置初始为白天
DaySky.Enabled = true
NightSky.Enabled = false
MoonRays.Enabled = false
MoonBloom.Enabled = false

-- 设置初始光照
lighting.ClockTime = currentTime
lighting.Brightness = 2.0
lighting.Ambient = Color3.fromRGB(128, 128, 128)
lighting.FogColor = Color3.fromRGB(200, 220, 255)
lighting.FogEnd = 1000
lighting.FogStart = 0
lighting.ExposureCompensation = 0.3

-- 时间流逝函数
local function updateTime()
    while true do
        -- 更新时间
        currentTime = currentTime + 0.1  -- 每6秒增加1小时
        
        if currentTime >= 24 then
            currentTime = 0
        end
        
        lighting.ClockTime = currentTime
        
        -- 根据时间切换昼夜
        if currentTime >= 19 or currentTime < 5 then
            -- 夜晚 (7pm - 5am)
            DaySky.Enabled = false
            NightSky.Enabled = true
            MoonRays.Enabled = true
            MoonBloom.Enabled = true
            lighting.Brightness = 0.8
            lighting.Ambient = Color3.fromRGB(40, 40, 60)
        else
            -- 白天 (5am - 7pm)
            DaySky.Enabled = true
            NightSky.Enabled = false
            MoonRays.Enabled = false
            MoonBloom.Enabled = false
            lighting.Brightness = 2.0
            lighting.Ambient = Color3.fromRGB(128, 128, 128)
        end
        
        wait(6)  -- 每6秒更新一次
    end
end

-- 启动时间流逝
spawn(updateTime)

print("时间流逝系统已启动！")
print("当前时间: " .. math.floor(currentTime) .. ":00")
print("时间会自动流逝，每6秒游戏时间前进1小时")
